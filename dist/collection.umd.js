!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Collection=e()}(this,(function(){"use strict";const t=t=>t.reduce(((t,e)=>t+e),0);var e={sum(e){const r=e?this.pluck(e):this.items;return t(r)},avg(e){const r=e?this.pluck(e):this.items;return t(n=r)/n.length;var n},median(t){return(t=>{const e=[...t].sort(((t,e)=>t-e)),r=Math.floor(e.length/2);return e.length%2!=0?e[r]:(e[r-1]+e[r])/2})(t?this.pluck(t):this.items)}},r={push(...t){return this.items.push(...t),this},pop(){return this.items.pop()},shift(){return this.items.shift()},unshift(...t){return this.items.unshift(...t),this}};const n=t=>"function"==typeof t;var s={get(t,e){return t.split(".").reduce(((t,r)=>t&&void 0!==t[r]?t[r]:e),this.items)},pluck(t){return this.map((e=>e[t]))},only(t){return this.map((e=>t.reduce(((t,r)=>({...t,[r]:e[r]})),{})))}},i={where(t,e,r){return 2===arguments.length&&(r=e,e="==="),this.filter((n=>{const s=n[t];switch(e){case"===":return s===r;case"!==":return s!==r;case">":return s>r;case">=":return s>=r;case"<":return s<r;case"<=":return s<=r;default:return!1}}))},whereIn(t,e){return this.filter((r=>e.includes(r[t])))},whereNotIn(t,e){return this.filter((r=>!e.includes(r[t])))}},o={map(t){return new this.constructor(this.items.map(t))},filter(t){return new this.constructor(this.items.filter(t))},reduce(t,e){return this.items.reduce(t,e)},flatten(t=1/0){return new this.constructor(this.items.flat(t))}};function u(t){return null===t||"object"!=typeof t?t:Array.isArray(t)?t.map(u):Object.fromEntries(Object.entries(t).map((([t,e])=>[t,u(e)])))}class c{constructor(t=[]){this.items=u(t)}static make(t){return new c(t)}_wrap(t){return t instanceof c?t:new c(t)}all(){return u(this.items)}count(){return this.items.length}first(){return this.items[0]}last(){return this.items[this.count()-1]}static macro(t,e){if(!n(e))throw new TypeError("Macro must be a function");c.prototype[t]=e}toArray(){return u(this.items)}toJson(){return JSON.stringify(this.items)}}return Object.assign(c.prototype,r),Object.assign(c.prototype,s),Object.assign(c.prototype,e),Object.assign(c.prototype,o),Object.assign(c.prototype,i),c.prototype.after=function(t){const e=this.items.findIndex((e=>e[t]===this.get(t)));return e>=0?new this.constructor(this.items.slice(e+1)):new this.constructor},c.prototype.chunk=function(t){const e=[];for(let r=0;r<this.items.length;r+=t)e.push(this.items.slice(r,r+t));return new this.constructor(e)},c.prototype.collapse=function(){return new this.constructor(this.items.flat())},c.prototype.combine=function(t){return new this.constructor(this.items.reduce(((e,r,n)=>(e[r]=t[n],e)),{}))},c.prototype.concat=function(t){return new this.constructor(this.items.concat(t))},c.prototype.contains=function(t){return this.items.includes(t)},c.prototype.diff=function(t){const e=this._wrap(t).all();return new this.constructor(this.items.filter((t=>!e.includes(t))))},c.prototype.every=function(t){return this.items.every(t)},c.prototype.except=function(t){const e=Array.isArray(t)?t:[t];return new this.constructor(Object.entries(this.items).filter((([t])=>!e.includes(t))).reduce(((t,[e,r])=>({...t,[e]:r})),{}))},c.prototype.firstWhere=function(t,e,r){return this.where(t,e,r).first()},c.prototype.flatMap=function(t){return this.map(t).collapse()},c.prototype.where=function(t,e,r){return 2===arguments.length&&(r=e,e="==="),this.filter((s=>{const i=s[t];switch(e){case"==":return i==r;case"===":return i===r;case"!=":return i!=r;case"!==":return i!==r;case">":return i>r;case">=":return i>=r;case"<":return i<r;case"<=":return i<=r;case"in":return Array.isArray(r)&&r.includes(i);case"not in":return Array.isArray(r)&&!r.includes(i);default:if(n(e))return e(i,r);throw new Error(`Invalid operator: ${e}`)}}))},c}));
